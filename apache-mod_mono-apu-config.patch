--- mod_mono-1.2.1/configure.in.orig	2006-11-21 23:24:50.000000000 +0100
+++ mod_mono-1.2.1/configure.in	2007-02-17 17:55:31.519007163 +0100
@@ -82,6 +82,28 @@
   fi
 ],)
 
+# check for --with-apu-config
+AC_ARG_WITH(apu-config,
+[  --with-apu-config=PATH  Path to apr-config (apache 2.0). You may use
+                          this option when apu-config is not in the same
+			  directory as apxs and the output of
+			  'apu-config --includes' is different from
+			  'apxs -q INCLUDEDIR'.
+],
+[
+  if test -x "$withval"
+  then
+    AC_MSG_RESULT([$withval executable, good])
+    APUCONFIG=$withval
+  else
+    if test "xno" = "x$withval" ; then
+    	AC_MSG_RESULT([no])
+    else
+        AC_MSG_ERROR([$withval not found or not executable])
+    fi
+  fi
+],)
+
 if test -z "$APXS"; then
   for mydir in /usr/local/apache2/sbin	\
   		/usr/local/apache2/bin	\
@@ -169,6 +191,48 @@
   AC_PATH_PROG(APRCONFIG, apr-config)
 fi
 
+if test -z "$APUCONFIG"; then
+  for mydir in `dirname ${APXS}` \
+  		/usr/local/apache2/sbin	\
+  		/usr/local/apache2/bin	\
+  		/usr/local/apache/sbin	\
+		/usr/local/apache/bin	\
+		/usr/sbin		\
+		/usr/bin
+  do
+	AC_MSG_CHECKING(for apu-1-config in $mydir)
+  	A1="$mydir/apu-1-config"
+  	if test -x "$A1" ; then
+		APUCONFIG="$A1"
+		AC_MSG_RESULT(found.)
+		break
+	else
+		AC_MSG_RESULT(no)
+	fi
+
+	AC_MSG_CHECKING(for apu-config in $mydir)
+	A2="$mydir/apu-config"
+  	if test -x "$A2" ; then
+		APUCONFIG="$A2"
+		AC_MSG_RESULT(found.)
+		break
+	else
+		AC_MSG_RESULT(no)
+	fi
+
+  done
+fi
+
+# last resort 1
+if test -z "$APUCONFIG"; then
+  AC_PATH_PROG(APUCONFIG, apu-1-config)
+fi
+
+# last resort 2
+if test -z "$APUCONFIG"; then
+  AC_PATH_PROG(APUCONFIG, apu-config)
+fi
+
 APXS_LIBEXECDIR=`${APXS} -q LIBEXECDIR`
 APXS_SYSCONFDIR=`${APXS} -q SYSCONFDIR`
 AP_INCLUDES="-I`${APXS} -q INCLUDEDIR`"
@@ -183,6 +247,10 @@
 	CFLAGS="$CFLAGS `$APRCONFIG --includes --cflags`"
 	CPPFLAGS="$CFLAGS $CPPFLAGS `$APRCONFIG --includes --cflags --cppflags`"
 fi
+if test -x "$APUCONFIG" ; then
+	CFLAGS="$CFLAGS `$APUCONFIG --includes`"
+	CPPFLAGS="$CFLAGS $CPPFLAGS `$APUCONFIG --includes`"
+fi
 AC_MSG_CHECKING([Apache version])
 AC_TRY_COMPILE([
 	#include <ap_release.h>
@@ -354,6 +422,7 @@
 echo "   * apxs = $APXS"
 test ! "$APACHE_VER" = "1.3" -a -x "$APRCONFIG" && \
 echo "   * apr-config = $APRCONFIG"
+echo "   * apu-config = $APUCONFIG"
 echo "   * Verbose logging (debug) = $enable_debug"
 echo "   * mono prefix = $MONO_PREFIX"
 echo "   * Default MonoApplicationsConfigDir = $DFLT_MONO_CONFIG_DIR"
